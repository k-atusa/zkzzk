<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>치지직 생방송 다운로더 - 녹화 영상</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'accent': 'rgb(113, 243, 166)',
						'accent-dark': 'rgb(89, 194, 133)',
						'accent-light': 'rgb(137, 255, 179)',
					}
				}
			}
		}
	</script>
	<script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
	<style>
		/* 어두운 테마 배경 */
		body {
			background:
				radial-gradient(circle at 20% 20%, rgba(113, 243, 166, 0.15) 0%, transparent 40%),
				radial-gradient(circle at 80% 80%, rgba(34, 197, 94, 0.15) 0%, transparent 40%),
				radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
				linear-gradient(135deg, #0f0f23 0%, #0a0a0a 100%);
			min-height: 100vh;
			color: #e0e0e0;
		}

		/* 네비게이션 바 */
		.navbar {
			background: rgba(15, 15, 35, 0.4);
			backdrop-filter: blur(20px);
			-webkit-backdrop-filter: blur(20px);
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		/* KATUSA 스타일 글래스모피즘 */
		.glass {
			background: rgba(255, 255, 255, 0.08);
			border-radius: 20px;
			box-shadow:
				0 8px 32px 0 rgba(0, 0, 0, 0.37),
				inset 0 1px 0 rgba(255, 255, 255, 0.1);
			backdrop-filter: blur(20px);
			-webkit-backdrop-filter: blur(20px);
			border: 1px solid rgba(255, 255, 255, 0.12);
			transition: all 0.3s ease;
		}

		.glass:hover {
			background: rgba(255, 255, 255, 0.12);
			box-shadow:
				0 12px 40px 0 rgba(0, 0, 0, 0.45),
				inset 0 1px 0 rgba(255, 255, 255, 0.15);
		}

		/* 카드 스타일 */
		.recording-card {
			background: rgba(255, 255, 255, 0.03);
			border: 1px solid rgba(255, 255, 255, 0.1);
			box-shadow:
				0 8px 32px 0 rgba(0, 0, 0, 0.4),
				inset 0 1px 0 rgba(255, 255, 255, 0.08);
			border-radius: 20px;
			transition: all 0.3s ease;
		}

		.recording-card:hover {
			background: rgba(255, 255, 255, 0.06);
			transform: translateY(-2px);
		}

		/* 스트리머 헤더 스타일 */
		.streamer-header {
			background: rgba(113, 243, 166, 0.15);
			border: 1px solid rgba(255, 255, 255, 0.1);
			color: #ffffff;
			border-radius: 20px;
		}

		/* 버튼 스타일 */
		.btn-primary {
			background: rgba(113, 243, 166, 0.8);
			border: 1px solid rgba(113, 243, 166, 0.3);
			backdrop-filter: blur(10px);
			border-radius: 12px;
			color: #0f0f23;
			font-weight: 600;
			transition: all 0.3s ease;
		}

		.btn-primary:hover {
			background: rgba(113, 243, 166, 1);
			border-color: rgba(113, 243, 166, 0.5);
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(113, 243, 166, 0.3);
		}

		.btn-danger {
			background: rgba(239, 68, 68, 0.8);
			border: 1px solid rgba(239, 68, 68, 0.3);
			backdrop-filter: blur(10px);
			border-radius: 12px;
			color: #ffffff;
			transition: all 0.3s ease;
		}

		.btn-danger:hover {
			background: rgba(239, 68, 68, 1);
			border-color: rgba(239, 68, 68, 0.5);
			transform: translateY(-1px);
		}

		/* 비디오 플레이어 */
		.video-player {
			width: 100%;
			aspect-ratio: 16/9;
			background-color: #000;
			border-radius: 12px;
		}

		.video-thumbnail {
			width: 100%;
			aspect-ratio: 16/9;
			background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all 0.3s ease;
			border: 2px solid rgba(255, 255, 255, 0.1);
		}

		.video-thumbnail:hover {
			border-color: rgb(113, 243, 166);
			transform: scale(1.02);
		}

		.play-button {
			width: 60px;
			height: 60px;
			background: rgba(113, 243, 166, 0.9);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: all 0.3s ease;
		}

		.play-button:hover {
			background: rgba(113, 243, 166, 1);
			transform: scale(1.1);
		}

		.video-container {
			position: relative;
		}

		.video-player.hidden {
			display: none;
		}

		.video-thumbnail.hidden {
			display: none;
		}

		/* 텍스트 색상 */
		.text-muted {
			color: rgba(255, 255, 255, 0.6);
		}

		.text-accent {
			color: rgb(113, 243, 166);
		}
	</style>
</head>

<body>
	<!-- Navigation Bar -->
	<nav class="navbar fixed top-0 w-full z-50 px-6 py-4">
		<div class="max-w-7xl mx-auto flex justify-between items-center">
			<a href="/" class="text-xl font-bold text-white">치지직 생방송 다운로더</a>
			<div class="hidden md:flex space-x-6">
				<a href="/live" class="text-white hover:text-accent transition-colors">라이브 녹화</a>
				<a href="/recordings" class="text-accent font-medium">녹화 영상</a>
			</div>
			<button class="md:hidden text-white" id="mobile-menu-btn">
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</div>
		<!-- Mobile Menu -->
		<div class="md:hidden hidden" id="mobile-menu">
			<div class="px-2 pt-2 pb-3 space-y-1">
				<a href="/live" class="block px-3 py-2 text-white hover:text-accent transition-colors">라이브 녹화</a>
				<a href="/recordings" class="block px-3 py-2 text-accent font-medium">녹화 영상</a>
			</div>
		</div>
	</nav>

	<div class="pt-20 pb-8 px-6">
		<div class="max-w-7xl mx-auto">
			{% for streamer_name, recordings in streamer_recordings.items() %}
			<div class="mb-8">
				<div class="streamer-header p-6 mb-6">
					<h2 class="text-2xl font-bold text-white">{{ streamer_name }}</h2>
				</div>
				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
					{% for recording in recordings %}
					<div class="recording-card p-6">
						<h3 class="text-lg font-semibold text-white mb-3 truncate">{{ recording.title }}</h3>
						<p class="text-muted text-sm mb-4">
							<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
									d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
							</svg>
							{{ recording.created_at.strftime('%Y-%m-%d %H:%M:%S') }}
						</p>
						<div class="video-container mb-4">
							<div class="video-thumbnail" data-filename="{{ recording.filename }}">
								<div class="play-button">
									<svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
											d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347c-.75.412-1.667-.13-1.667-.986V5.653Z">
										</path>
									</svg>
								</div>
							</div>
							<video class="video-player hidden" controls data-filename="{{ recording.filename }}">
								<source src="/recordings/{{ recording.filename }}" type="video/mp4">
								Your browser does not support the video tag.
							</video>
						</div>
						<div class="flex justify-between items-center">
							<a href="/recordings/{{ recording.filename }}" class="btn-primary px-4 py-2" download>
								<svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
										d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
									</path>
								</svg>
								다운로드
							</a>
							<button class="btn-danger p-2 delete-recording" data-filename="{{ recording.filename }}">
								<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
										d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
									</path>
								</svg>
							</button>
						</div>
					</div>
					{% endfor %}
				</div>
			</div>
			{% endfor %}
		</div>
	</div>

	<!-- Custom JavaScript -->
	<script>
		document.getElementById('mobile-menu-btn').addEventListener('click', function () {
			document.getElementById('mobile-menu').classList.toggle('hidden');
		});

		document.querySelectorAll('.delete-recording').forEach(button => {
			button.addEventListener('click', async (e) => {
				if (confirm('정말로 이 녹화 영상을 삭제하시겠습니까?')) {
					const filename = e.target.closest('.delete-recording').dataset.filename;
					try {
						const response = await fetch(`/delete_recording/${filename}`, {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							}
						});
						const data = await response.json();

						if (data.status === 'success') {
							const card = e.target.closest('.recording-card');
							const streamerSection = card.closest('.mb-8');
							card.remove();

							const remainingCards = streamerSection.querySelectorAll('.recording-card');
							if (remainingCards.length === 0) {
								streamerSection.remove();
							}
						} else {
							alert(data.message);
						}
					} catch (error) {
						console.error('Error:', error);
						alert('녹화 영상 삭제 중 오류가 발생했습니다.');
					}
				}
			});
		});

		document.querySelectorAll('.video-thumbnail').forEach(thumbnail => {
			thumbnail.addEventListener('click', function () {
				const filename = this.dataset.filename;
				const video = document.querySelector(`video[data-filename="${filename}"]`);
				const thumbnailContainer = this.closest('.video-container');

				document.querySelectorAll('.video-player').forEach(v => v.classList.add('hidden'));
				document.querySelectorAll('.video-thumbnail').forEach(t => t.classList.remove('hidden'));

				video.classList.remove('hidden');
				this.classList.add('hidden');
			});
		});
	</script>
</body>

</html>