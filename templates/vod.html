<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>치지직 생방송 다운로더 - 다시보기 다운로드</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'accent': 'rgb(113, 243, 166)',
						'accent-dark': 'rgb(89, 194, 133)',
						'accent-light': 'rgb(137, 255, 179)',
					}
				}
			}
		}
	</script>
	<script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
	<style>
		/* 어두운 테마 배경 */
		body {
			background:
				radial-gradient(circle at 20% 20%, rgba(113, 243, 166, 0.15) 0%, transparent 40%),
				radial-gradient(circle at 80% 80%, rgba(34, 197, 94, 0.15) 0%, transparent 40%),
				radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
				linear-gradient(135deg, #0f0f23 0%, #0a0a0a 100%);
			min-height: 100vh;
			color: #e0e0e0;
		}

		/* 네비게이션 바 */
		.navbar {
			background: rgba(15, 15, 35, 0.4);
			backdrop-filter: blur(20px);
			-webkit-backdrop-filter: blur(20px);
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		/* 폼 요소 */
		.form-input {
			background: rgba(255, 255, 255, 0.08);
			border: 1px solid rgba(255, 255, 255, 0.1);
			color: #e0e0e0;
			border-radius: 12px;
			padding: 0.75rem 1rem;
			width: 100%;
			transition: all 0.3s ease;
		}

		.form-input:focus {
			background: rgba(255, 255, 255, 0.12);
			border-color: rgb(113, 243, 166);
			box-shadow: 0 0 0 3px rgba(113, 243, 166, 0.25);
			color: #ffffff;
			outline: none;
		}

		.form-input::placeholder {
			color: rgba(255, 255, 255, 0.5);
		}

		/* 버튼 스타일 */
		.btn-primary {
			background: rgba(113, 243, 166, 0.8);
			border: 1px solid rgba(113, 243, 166, 0.3);
			backdrop-filter: blur(10px);
			border-radius: 12px;
			color: #0f0f23;
			font-weight: 600;
			transition: all 0.3s ease;
		}

		.btn-primary:hover {
			background: rgba(113, 243, 166, 1);
			border-color: rgba(113, 243, 166, 0.5);
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(113, 243, 166, 0.3);
		}

		.btn-primary:disabled {
			background: rgba(113, 243, 166, 0.4);
			cursor: not-allowed;
			transform: none;
		}

		/* 다운로드 카드 */
		.download-card {
			background: rgba(255, 255, 255, 0.03);
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 12px;
			transition: all 0.3s ease;
		}

		.download-card:hover {
			background: rgba(255, 255, 255, 0.06);
		}

		/* 프로그레스 바 */
		.progress-bar {
			background: rgba(255, 255, 255, 0.1);
			border-radius: 8px;
			overflow: hidden;
		}

		.progress-fill {
			background: linear-gradient(90deg, rgb(113, 243, 166), rgb(34, 197, 94));
			height: 100%;
			transition: width 0.3s ease;
		}

		/* 텍스트 색상 */
		.text-muted {
			color: rgba(255, 255, 255, 0.6);
		}

		.text-accent {
			color: rgb(113, 243, 166);
		}
	</style>
</head>

<body>
	<!-- Navigation Bar -->
	<nav class="navbar fixed top-0 w-full z-50 px-6 py-4">
		<div class="max-w-7xl mx-auto flex justify-between items-center">
			<a href="/" class="text-xl font-bold text-white">치지직 생방송 다운로더</a>
			<div class="hidden md:flex space-x-6">
				<a href="/live" class="text-white hover:text-accent transition-colors">라이브 녹화</a>
				<a href="/recordings" class="text-white hover:text-accent transition-colors">녹화 영상</a>
				<a href="/vod" class="text-accent font-medium">다시보기 다운</a>
			</div>
			<button class="md:hidden text-white" id="mobile-menu-btn">
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</div>
		<!-- Mobile Menu -->
		<div class="md:hidden hidden" id="mobile-menu">
			<div class="px-2 pt-2 pb-3 space-y-1">
				<a href="/live" class="block px-3 py-2 text-white hover:text-accent transition-colors">라이브 녹화</a>
				<a href="/recordings" class="block px-3 py-2 text-white hover:text-accent transition-colors">녹화 영상</a>
				<a href="/vod" class="block px-3 py-2 text-accent font-medium">다시보기 다운</a>
			</div>
		</div>
	</nav>

	<div class="pt-20 pb-8 px-6">
		<div class="max-w-4xl mx-auto">
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-white mb-2">다시보기 다운로드</h2>
				<p class="text-muted">치지직 다시보기 URL을 입력하면 영상을 다운로드할 수 있습니다.</p>
			</div>

			<form id="vodInfoForm" class="mb-8">
				<div class="mb-4">
					<label for="vodUrl" class="block text-lg font-semibold text-white mb-4">치지직 다시보기 URL</label>
					<div class="flex gap-4">
						<input type="url" class="form-input h-12 flex-1" id="vodUrl" 
							placeholder="https://chzzk.naver.com/video/..." required 
							pattern="https?://chzzk\.naver\.com/video/.*">
						<button type="submit" class="btn-primary h-12 px-6" id="getInfoBtn">
							<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
									d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
							</svg>
							정보 가져오기
						</button>
					</div>
					<p class="text-muted text-sm mt-1">다시보기 URL을 입력하면 영상 정보와 다운로드 링크를 제공합니다.</p>
				</div>
			</form>

			<div id="vodInfo" class="hidden">
				<div class="download-card p-6 mb-4">
					<div class="flex justify-between items-start mb-4">
						<div class="flex-1">
							<h3 class="text-lg font-semibold text-white mb-2" id="videoTitle">영상 제목</h3>
							<div class="text-sm text-muted space-y-1">
								<p id="videoAuthor"></p>
								<p id="videoCategory">카테고리: </p>
								<p id="videoSize">파일 크기: </p>
							</div>
						</div>
						<div class="flex flex-col gap-2">
							<a href="#" id="downloadLink" class="btn-primary px-4 py-2 text-sm" target="_blank">
								<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
										d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
								</svg>
								다운로드
							</a>
							<button id="copyUrlBtn" class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-lg text-sm transition-colors">
								<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
										d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
								</svg>
								URL 복사
							</button>
						</div>
					</div>
					<div class="bg-gray-800 rounded-lg p-3">
						<p class="text-xs text-muted mb-2">다운로드 URL:</p>
						<div class="flex gap-2">
							<input type="text" id="streamUrl" class="form-input text-xs flex-1" readonly>
							<button id="copyStreamUrlBtn" class="bg-gray-600 hover:bg-gray-500 text-white px-3 py-1 rounded text-xs transition-colors">
								복사
							</button>
						</div>
					</div>
				</div>
			</div>

			<div id="usageInfo" class="mt-8">
				<div class="download-card p-6">
					<h3 class="text-lg font-semibold text-white mb-4">사용 방법</h3>
					<div class="text-sm text-muted space-y-2">
						<p>1. 치지직 다시보기 URL을 입력하고 "정보 가져오기" 버튼을 클릭합니다.</p>
						<p>2. 영상 정보와 다운로드 링크가 표시됩니다.</p>
						<p>3. "다운로드" 버튼을 클릭하여 브라우저에서 직접 다운로드하거나,</p>
						<p>4. "URL 복사" 버튼을 클릭하여 다운로드 링크를 복사할 수 있습니다.</p>
						<p class="text-accent mt-4">💡 팁: 다운로드 링크는 일정 시간 후 만료될 수 있으니 빠르게 사용하세요.</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Custom JavaScript -->
	<script>
		// Mobile menu toggle
		document.getElementById('mobile-menu-btn').addEventListener('click', function () {
			document.getElementById('mobile-menu').classList.toggle('hidden');
		});

		// VOD 정보 가져오기 폼 처리
		document.getElementById('vodInfoForm').addEventListener('submit', async (e) => {
			e.preventDefault();
			const vodUrl = document.getElementById('vodUrl').value;
			const getInfoBtn = document.getElementById('getInfoBtn');
			const vodInfoDiv = document.getElementById('vodInfo');

			try {
				getInfoBtn.disabled = true;
				getInfoBtn.innerHTML = `
					<svg class="w-5 h-5 inline mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
					</svg>
					처리 중...
				`;

				const response = await fetch('/get_vod_info', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ vod_url: vodUrl })
				});

				const data = await response.json();

				if (data.status === 'success') {
					// VOD 정보 표시
					document.getElementById('videoTitle').textContent = data.video_info.title;
					document.getElementById('videoAuthor').textContent = `${data.video_info.author}`;
					document.getElementById('videoCategory').textContent = `카테고리: ${data.video_info.category}`;
					document.getElementById('videoSize').textContent = `파일 크기: ${data.file_size_mb} MB`;
					
					// 다운로드 링크 설정
					const downloadLink = document.getElementById('downloadLink');
					downloadLink.href = data.stream_url;
					downloadLink.download = `${data.video_info.title}.mp4`;
					
					// 스트림 URL 표시
					document.getElementById('streamUrl').value = data.stream_url;
					
					vodInfoDiv.classList.remove('hidden');
				} else {
					alert(data.message);
				}
			} catch (error) {
				console.error('Error:', error);
				alert('VOD 정보 가져오기 중 오류가 발생했습니다.');
			} finally {
				getInfoBtn.disabled = false;
				getInfoBtn.innerHTML = `
					<svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
							d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
					</svg>
					정보 가져오기
				`;
			}
		});

		// URL 복사 기능
		document.getElementById('copyUrlBtn').addEventListener('click', async () => {
			const streamUrl = document.getElementById('streamUrl').value;
			try {
				await navigator.clipboard.writeText(streamUrl);
				alert('다운로드 URL이 클립보드에 복사되었습니다.');
			} catch (error) {
				console.error('Error copying URL:', error);
				alert('URL 복사 중 오류가 발생했습니다.');
			}
		});

		document.getElementById('copyStreamUrlBtn').addEventListener('click', async () => {
			const streamUrl = document.getElementById('streamUrl').value;
			try {
				await navigator.clipboard.writeText(streamUrl);
				alert('스트림 URL이 클립보드에 복사되었습니다.');
			} catch (error) {
				console.error('Error copying stream URL:', error);
				alert('스트림 URL 복사 중 오류가 발생했습니다.');
			}
		});


	</script>
</body>

</html> 