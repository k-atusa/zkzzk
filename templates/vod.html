<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ZKZZK - 다시보기 다운로드</title>
	<script src="https://cdn.tailwindcss.com"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						'accent': 'rgb(113, 243, 166)',
						'accent-dark': 'rgb(89, 194, 133)',
						'accent-light': 'rgb(137, 255, 179)',
					}
				}
			}
		}
	</script>
	<script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
	<style>
		/* 어두운 테마 배경 */
		body {
			background:
				radial-gradient(circle at 20% 20%, rgba(113, 243, 166, 0.15) 0%, transparent 40%),
				radial-gradient(circle at 80% 80%, rgba(34, 197, 94, 0.15) 0%, transparent 40%),
				radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
				linear-gradient(135deg, #0f0f23 0%, #0a0a0a 100%);
			min-height: 100vh;
			color: #e0e0e0;
		}

		/* 네비게이션 바 */
		.navbar {
			background: rgba(15, 15, 35, 0.4);
			backdrop-filter: blur(20px);
			-webkit-backdrop-filter: blur(20px);
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		/* 폼 요소 */
		.form-input {
			background: rgba(255, 255, 255, 0.08);
			border: 1px solid rgba(255, 255, 255, 0.1);
			color: #e0e0e0;
			border-radius: 12px;
			padding: 0.75rem 1rem;
			width: 100%;
			transition: all 0.3s ease;
		}

		.form-input:focus {
			background: rgba(255, 255, 255, 0.12);
			border-color: rgb(113, 243, 166);
			box-shadow: 0 0 0 3px rgba(113, 243, 166, 0.25);
			color: #ffffff;
			outline: none;
		}

		.form-input::placeholder {
			color: rgba(255, 255, 255, 0.5);
		}

		/* 버튼 스타일 */
		.btn-primary {
			background: rgba(113, 243, 166, 0.8);
			border: 1px solid rgba(113, 243, 166, 0.3);
			backdrop-filter: blur(10px);
			border-radius: 12px;
			color: #0f0f23;
			font-weight: 600;
			transition: all 0.3s ease;
		}

		.btn-primary:hover {
			background: rgba(113, 243, 166, 1);
			border-color: rgba(113, 243, 166, 0.5);
			transform: translateY(-1px);
			box-shadow: 0 4px 12px rgba(113, 243, 166, 0.3);
		}

		.btn-primary:disabled {
			background: rgba(113, 243, 166, 0.4);
			cursor: not-allowed;
			transform: none;
		}

		/* 다운로드 카드 */
		.download-card {
			background: rgba(255, 255, 255, 0.03);
			border: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 12px;
			transition: all 0.3s ease;
		}

		.download-card:hover {
			background: rgba(255, 255, 255, 0.06);
		}

		/* 프로그레스 바 */
		.progress-bar {
			background: rgba(255, 255, 255, 0.1);
			border-radius: 8px;
			overflow: hidden;
		}

		.progress-fill {
			background: linear-gradient(90deg, rgb(113, 243, 166), rgb(34, 197, 94));
			height: 100%;
			transition: width 0.3s ease;
		}

		/* 텍스트 색상 */
		.text-muted {
			color: rgba(255, 255, 255, 0.6);
		}

		.text-accent {
			color: rgb(113, 243, 166);
		}
	</style>
</head>

<body>
	<!-- Navigation Bar -->
	<nav class="navbar fixed top-0 w-full z-50 px-6 py-4">
		<div class="max-w-7xl mx-auto flex justify-between items-center">
			<a href="/" class="text-xl font-bold text-white">ZKZZK</a>
			<div class="hidden md:flex space-x-6">
				<a href="/live" class="text-white hover:text-accent transition-colors">라이브 녹화</a>
				<a href="/recordings" class="text-white hover:text-accent transition-colors">녹화 영상</a>
				<a href="/vod" class="text-accent font-medium">다시보기 다운로드</a>
			</div>
			<button class="md:hidden text-white" id="mobile-menu-btn">
				<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
				</svg>
			</button>
		</div>
		<!-- Mobile Menu -->
		<div class="md:hidden hidden" id="mobile-menu">
			<div class="px-2 pt-2 pb-3 space-y-1">
				<a href="/live" class="block px-3 py-2 text-white hover:text-accent transition-colors">라이브 녹화</a>
				<a href="/recordings" class="block px-3 py-2 text-white hover:text-accent transition-colors">녹화 영상</a>
				<a href="/vod" class="block px-3 py-2 text-accent font-medium">다시보기 다운로드</a>
			</div>
		</div>
	</nav>

	<div class="pt-20 pb-8 px-6">
		<div class="max-w-4xl mx-auto">
			<div class="mb-8">
				<h2 class="text-2xl font-bold text-white mb-2">다시보기 다운로드</h2>
			</div>

			<form id="vodInfoForm" class="mb-8">
				<div class="mb-4">
					<label for="vodUrl" class="block text-lg font-semibold text-white mb-4">치지직 다시보기 URL</label>
					<div class="flex gap-4">
						<input type="url" class="form-input h-12 flex-1" id="vodUrl" placeholder="https://chzzk.naver.com/video/..."
							required pattern="https?://chzzk\.naver\.com/video/.*">
						<button type="submit" class="btn-primary h-12 px-6" id="getInfoBtn">
							검색
						</button>
					</div>
					<p class="text-muted text-sm mt-1">치지직 다시보기 URL을 입력하면 영상 정보와 다운로드 링크를 제공합니다.</p>
				</div>
			</form>

			<div id="vodInfo" class="hidden">
				<div class="download-card p-6 mb-4">
					<div class="flex justify-between items-start mb-4">
						<div class="flex-1">
							<h3 class="text-lg font-semibold text-white mb-2" id="videoTitle">영상 제목</h3>
							<div class="text-sm text-muted space-y-1">
								<p id="videoAuthor"></p>
								<div class="flex flex-wrap gap-1">
									<div id="videoCategory" class="hidden">
										<span class="bg-accent bg-opacity-20 text-accent text-xs px-2 py-1 rounded-full"
											id="categoryTag"></span>
									</div>
									<div id="videoTags" class="hidden">
										<div class="flex flex-wrap gap-1" id="tagsContainer"></div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- 화질 선택 섹션 -->
					<div class="mb-4">
						<h4 class="text-md font-semibold text-white mb-3">화질 선택</h4>
						<div id="resolutionOptions" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
							<!-- 화질 옵션들이 여기에 동적으로 추가됩니다 -->
						</div>
					</div>

					<!-- 다운로드 버튼 -->
					<div id="selectedQualityInfo" class="hidden mb-4">
						<div class="flex gap-2">
							<a href="#" id="downloadLink" class="btn-primary px-4 py-2 text-sm" target="_blank">
								다운로드
							</a>
							<button id="copyUrlBtn"
								class="bg-gray-600 hover:bg-gray-500 text-white px-4 py-2 rounded-xl text-sm transition-colors">
								URL 복사
							</button>
						</div>
					</div>
				</div>
			</div>


		</div>
	</div>

	<!-- Custom JavaScript -->
	<script>
		// Mobile menu toggle
		document.getElementById('mobile-menu-btn').addEventListener('click', function () {
			document.getElementById('mobile-menu').classList.toggle('hidden');
		});

		// VOD 정보 가져오기 폼 처리
		document.getElementById('vodInfoForm').addEventListener('submit', async (e) => {
			e.preventDefault();
			const vodUrl = document.getElementById('vodUrl').value;
			const getInfoBtn = document.getElementById('getInfoBtn');
			const vodInfoDiv = document.getElementById('vodInfo');

			try {
				getInfoBtn.disabled = true;
				getInfoBtn.innerHTML = `
					<svg class="w-5 h-5 inline mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
					</svg>
					처리 중...
				`;

				const response = await fetch('/get_vod_info', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({ vod_url: vodUrl })
				});

				const data = await response.json();

				if (data.status === 'success') {
					// VOD 정보 표시
					document.getElementById('videoTitle').textContent = data.video_info.title;
					document.getElementById('videoAuthor').textContent = `${data.video_info.author}`;

					// 카테고리 표시
					if (data.video_info.category) {
						document.getElementById('categoryTag').textContent = data.video_info.category;
						document.getElementById('videoCategory').classList.remove('hidden');
					} else {
						document.getElementById('videoCategory').classList.add('hidden');
					}

					// 태그 표시
					if (data.video_info.tags && data.video_info.tags.length > 0) {
						const tagsContainer = document.getElementById('tagsContainer');
						tagsContainer.innerHTML = '';

						data.video_info.tags.forEach(tag => {
							const tagSpan = document.createElement('span');
							tagSpan.className = 'bg-white bg-opacity-10 text-white text-xs px-2 py-1 rounded-full';
							tagSpan.textContent = tag;
							tagsContainer.appendChild(tagSpan);
						});

						document.getElementById('videoTags').classList.remove('hidden');
					} else {
						document.getElementById('videoTags').classList.add('hidden');
					}

					// 화질 옵션 생성
					createResolutionOptions(data.resolutions, data.video_info.title);

					vodInfoDiv.classList.remove('hidden');
				} else {
					alert(data.message);
				}
			} catch (error) {
				console.error('Error:', error);
				alert('VOD 정보 가져오기 중 오류가 발생했습니다.');
			} finally {
				getInfoBtn.disabled = false;
				getInfoBtn.innerHTML = `검색`;
			}
		});

		// 화질 옵션 생성 함수
		function createResolutionOptions(resolutions, videoTitle) {
			const container = document.getElementById('resolutionOptions');
			container.innerHTML = '';

			resolutions.forEach((resolution, index) => {
				const optionDiv = document.createElement('div');
				optionDiv.className = 'bg-gray-800 border border-gray-700 rounded-lg p-4 cursor-pointer transition-all hover:border-accent hover:bg-gray-700';
				optionDiv.dataset.resolution = resolution.resolution;
				optionDiv.dataset.downloadUrl = resolution.download_url;
				optionDiv.dataset.estimatedSize = resolution.estimated_size_mb;

				optionDiv.innerHTML = `
					<div class="flex justify-between items-center mb-2">
						<span class="text-white font-medium">${resolution.resolution}</span>
						<span class="text-accent text-sm">${resolution.quality}</span>
					</div>
					<div class="text-sm text-muted space-y-1">
						<p>비트레이트: ${(resolution.bandwidth / 1000).toFixed(0)} Kbps</p>
						<p>예상 크기: ${resolution.estimated_size_mb} MB</p>
					</div>
				`;

				// 클릭 이벤트 추가
				optionDiv.addEventListener('click', () => {
					// 모든 옵션에서 선택 상태 제거
					document.querySelectorAll('#resolutionOptions > div').forEach(div => {
						div.classList.remove('border-accent', 'bg-gray-700');
						div.classList.add('border-gray-700', 'bg-gray-800');
					});

					// 선택된 옵션 강조
					optionDiv.classList.remove('border-gray-700', 'bg-gray-800');
					optionDiv.classList.add('border-accent', 'bg-gray-700');

					// 선택된 화질 정보 표시
					showSelectedQuality(resolution, videoTitle);
				});

				container.appendChild(optionDiv);

				// 첫 번째 옵션을 기본으로 선택
				if (index === 0) {
					optionDiv.click();
				}
			});
		}

		// 선택된 화질 정보 표시 함수
		function showSelectedQuality(resolution, videoTitle) {
			const selectedQualityInfo = document.getElementById('selectedQualityInfo');
			const downloadLink = document.getElementById('downloadLink');

			downloadLink.href = resolution.download_url;
			downloadLink.download = `${videoTitle}_${resolution.quality}.mp4`;

			selectedQualityInfo.classList.remove('hidden');
		}

		// URL 복사 기능
		document.getElementById('copyUrlBtn').addEventListener('click', async () => {
			const downloadLink = document.getElementById('downloadLink');
			const url = downloadLink.href;
			try {
				await navigator.clipboard.writeText(url);
				alert('다운로드 URL이 클립보드에 복사되었습니다.');
			} catch (error) {
				console.error('Error copying URL:', error);
				alert('URL 복사 중 오류가 발생했습니다.');
			}
		});


	</script>
</body>

</html>